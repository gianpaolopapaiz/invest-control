<div class="container">
  <%= link_to '<< Portfolio', portfolio_path(@portfolio), class: 'btn btn-secondary btn-sm mb-3' %> 
  <h1 class='mb-4'><%= @portfolio.name %></h1> 
  <h2 class='mb-2'>Stocks:</h2>
  <%= link_to 'Add stock', portfolio_stocks_choose_stock_path(@portfolio), class: 'btn btn-primary btn-sm mb-3' %>
  <%= link_to 'Update stocks', update_stocks_price_path(@portfolio), class: 'btn btn-secondary btn-sm mb-3' %>
  
  <% if @stocks.length > 0 %>
    <h4><strong>Summary</strong></h4>
    <p class="card-text mb-0">Ammount: <%= number_to_currency(@stocks_actual_amount) %></p>
    <p class="card-text mb-0">Return Tax: <%= @stocks_return_tax.round(2) %>%</p>
    <p class="card-text">Return Value: <%= number_to_currency(@stocks_return_value) %></p>
  <% end %>
  
  <% if @query && @query != '' %>
    <div class='d-flex align-items-center'>
      <h4 class='mb-0'>Stocks filtered by: "<%= @query %>" (<%= @stocks.length %>) | </h4>
      <%= link_to 'remove filter', portfolio_stocks_path(@portfolio), class: 'ml-2' %>
    </div>
  <% else %>
    <h4 class='mb-0'>All Stocks (<%= @stocks.length %>):</h4>
  <% end %>
  
  <%= form_tag portfolio_stocks_path(@portfolio, remote: true), method: :get, class: 'form-inline' do %>
    <%= text_field_tag :query, params[:query], class: "form-control mr-1 my-2", placeholder: "Symbol or advisor..." %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
  <% end %> 
  
  <% if @stocks.length.positive? %>
    <div class='d-flex align-items-center justify-content-start flex-wrap'>
      <% @stocks.each do |stock| %>     
        <div class="card m-1" style="width: 16rem;">
          <div class="card-body">
            <h5 class="card-title"><strong><%= stock.symbol %></strong></h5>
            <h6 class="card-subtitle mb-2 text-muted"><%= stock.short_name %></h6>
            <h6 class="card-subtitle mb-2 text-muted">Advisor: <%= stock.advisor %></h6>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Amount:</span> 
              <span><%= number_to_currency(stock.amount) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Buy Date:</span>
              <span><%= stock.buy_date.strftime("%Y/%m/%d") %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Quantity:</span>
              <span><%= stock.buy_quantity %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Buy Price:</span>
              <span><%= number_to_currency(stock.buy_price) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Actual Date:</span>
              <span><%= stock.actual_date.strftime("%Y/%m/%d") %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Actual Price:</span>
              <span><%= number_to_currency(stock.actual_price) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Return Tax:</span>
              <span><%= stock.return_tax.round(2) %>%</span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Return Value:</span>
              <span><%= number_to_currency(stock.return_value) %></span>
            </div>
            <div class='mt-3 text-right'>
              <%= link_to 'edit', edit_stock_path(stock), class: 'btn btn-secondary btn-sm'  %>
              <%= link_to 'remove', stock_path(stock), method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger btn-sm'  %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>(No stock added yet!)</p>
  <% end %>
</div>
