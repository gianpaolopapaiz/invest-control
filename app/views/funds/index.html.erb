<div class="container mb-4">
  <div class='d-flex align-items-center justify-content-between flex-wrap'>
    <%= link_to '', portfolio_path(@portfolio), class: "fas fa-chevron-left app-btn-flat" %>
    <div class='d-flex align-items-center justify-content-start flex-column'>
      <h2 class='mb-0'><%= @portfolio.name %> </h2>
      <h5 class='mb-0'>Fundos</h5>
    </div>
		<button class="fas fa-ellipsis-v app-btn-flat" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
		<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <%= link_to 'Adicionar', portfolio_funds_choose_fund_path(@portfolio), class: 'dropdown-item' %>
      <%= link_to 'Atualizar', update_funds_price_path(@portfolio), class: 'dropdown-item' %>
		</div>
	</div>
	<hr>

  <% if @funds.length > 0 %>
    <h4><strong>Sumário</strong></h4>
    <p class="card-text mb-0">Montante: <%= number_to_currency(@funds_actual_amount, unit:'R$', separator: ',', delimiter: '.') %></p>
    <p class="card-text mb-0">Taxa de retorno: <%= number_to_percentage(@funds_return_tax, separator: ',', delimiter: '.', precision: 2) %></p>
    <p class="card-text">Retorno absoluto: <%= number_to_currency(@funds_return_value, unit:'R$', separator: ',', delimiter: '.') %></p>
  <% end %>
  
  <% if @query && @query != '' %>
      <h4 class='mb-0'><strong>Fundos filtrados por:</strong></h4>
    <div class='d-flex justify-content-between align-items-center'>
      <h4>"<%= @query %>" (<%= @funds.length %>)</h4>
      <%= link_to 'remover filtro', portfolio_funds_path(@portfolio), class: 'ml-2' %>
    </div>
  <% else %>
    <h4 class='mb-0'><strong>Fundos (<%= @funds.length %>):</strong></h4>
  <% end %>
  
  <%= form_tag portfolio_funds_path(@portfolio, remote: true), method: :get, class: 'form' do %>
    <div class='d-flex align-items-center justify-content-between'>
      <%= text_field_tag :query, params[:query], class: "form-control mr-1 my-2", placeholder: "Cnpj, nome ou advisor..." %>
      <%= button_tag type: 'submit', class: "btn btn-primary", id: "register-button" do %>
        <i class="fas fa-search"></i>
      <% end %>
    </div>
  <% end %> 
  
  <% if @funds.length.positive? %>
    <div class='d-flex align-items-strech justify-content-start flex-wrap'>
      <% @funds.each do |fund| %>     
        <div class="card invest-card m-1" style="width: 16rem;">
          <div class="dropdown"> 
						<button class="fas fa-cog fixed-top-right text-muted" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <%= link_to 'Editar', edit_fund_path(fund), class: 'dropdown-item'  %>
              <%= link_to 'Remover', fund_path(fund), method: :delete, data: { confirm: "Você tem certeza?" }, class: 'dropdown-item'  %>
						</div>
					</div>
          <div class="card-body">
            <h5 class="card-title" title='<%= fund.short_name %>'><strong><%= truncate(fund.short_name, length: 50) %></strong></h5>
            <h6 class="card-subtitle mb-2 text-muted">CNPJ: <%= fund.cnpj %></h6>
            <h6 class="card-subtitle mb-2 text-muted">Estratégia: <%= fund.strategy %></h6>
            <h6 class="card-subtitle mb-2 text-muted">Advisor: <%= fund.advisor %></h6>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Montante:</span> 
              <span><%= number_to_currency(fund.amount, unit:'R$', separator: ',', delimiter: '.') %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Data de entrada:</span>
              <span><%= fund.buy_date.strftime("%d/%m/%y") %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Quantidade:</span>
              <span><%= fund.buy_quantity %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Preço de entrada:</span>
              <span><%= number_to_currency(fund.buy_price, unit:'R$', separator: ',', delimiter: '.') %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Data atualização:</span>
              <% if fund.actual_date %>
                <span><%= fund.actual_date.strftime("%d/%m/%y") %></span>  
              <% end %>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Preço atualização:</span>
              <span><%= number_to_currency(fund.actual_price, unit:'R$', separator: ',', delimiter: '.') %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span><strong>Taxa de retorno:</strong></span>
              <span><strong><%= number_to_percentage(fund.return_tax, separator: ',', delimiter: '.', precision: 2) %></strong></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span><strong>Retorno absoluto:</strong></span>
              <span><strong><%= number_to_currency(fund.return_value, unit:'R$', separator: ',', delimiter: '.') %></strong></span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>(No fund added yet!)</p>
  <% end %>
</div>
