<div class="container">
  <%= link_to '<< Portfolio', portfolio_path(@portfolio), class: 'btn btn-secondary btn-sm mb-3' %> 
  <h1 class='mb-4'><%= @portfolio.name %></h1> 
  <h2 class='mb-2'>Funds:</h2>
  <%= link_to 'Add fund', portfolio_funds_choose_fund_path(@portfolio), class: 'btn btn-primary btn-sm mb-3' %>
  <%= link_to 'Update funds', update_funds_price_path(@portfolio), class: 'btn btn-secondary btn-sm mb-3' %>
  
  <% if @funds.length > 0 %>
    <h4><strong>Summary</strong></h4>
    <p class="card-text mb-0">Ammount: <%= number_to_currency(@fundss_actual_amount) %></p>
    <p class="card-text mb-0">Return Tax: <%#= @funds_return_tax.round(2) %>%</p>
    <p class="card-text">Return Value: <%= number_to_currency(@fundss_return_value) %></p>
  <% end %>
  
  <% if @query && @query != '' %>
    <div class='d-flex align-items-center'>
      <h4 class='mb-0'>Funds filtered by: "<%= @query %>" (<%= @funds.length %>) | </h4>
      <%= link_to 'remove filter', portfolio_funds_path(@portfolio), class: 'ml-2' %>
    </div>
  <% else %>
    <h4 class='mb-0'>All Funds (<%= @funds.length %>):</h4>
  <% end %>
  
  <%= form_tag portfolio_funds_path(@portfolio, remote: true), method: :get, class: 'form-inline' do %>
    <%= text_field_tag :query, params[:query], class: "form-control mr-1 my-2", placeholder: "Cnpj, name or advisor..." %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
  <% end %> 
  
  <% if @funds.length.positive? %>
    <div class='d-flex align-items-strech justify-content-start flex-wrap'>
      <% @funds.each do |fund| %>     
        <div class="card m-1" style="width: 16rem;">
          <div class="card-body">
            <h5 class="card-title" title='<%= fund.short_name %>'><strong><%= truncate(fund.short_name, length: 30) %></strong></h5>
            <h6 class="card-subtitle mb-2 text-muted"><%= fund.cnpj %></h6>
            <h6 class="card-subtitle mb-2 text-muted">Strategy: <%= fund.strategy %></h6>
            <h6 class="card-subtitle mb-2 text-muted">Advisor: <%= fund.advisor %></h6>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Amount:</span> 
              <span><%#= number_to_currency(fund.amount) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Buy Date:</span>
              <span><%= fund.buy_date.strftime("%Y/%m/%d") %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Quantity:</span>
              <span><%= fund.buy_quantity %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Buy Price:</span>
              <span><%= number_to_currency(fund.buy_price) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Actual Date:</span>
              <span><%#= fund.actual_date.strftime("%Y/%m/%d") %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Actual Price:</span>
              <span><%= number_to_currency(fund.actual_price) %></span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Return Tax:</span>
              <span><%#= fund.return_tax.round(2) %>%</span>
            </div>
            <div class="card-text mb-0 d-flex align-items-center justify-content-between">
              <span>Return Value:</span>
              <span><%#= number_to_currency(fund.return_value) %></span>
            </div>
            <div class='mt-3 text-right'>
              <%= link_to 'edit', edit_fund_path(fund), class: 'btn btn-secondary btn-sm'  %>
              <%= link_to 'remove', fund_path(fund), method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger btn-sm'  %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>(No fund added yet!)</p>
  <% end %>
</div>
